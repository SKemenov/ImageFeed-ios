# ImageFeed-ios (Sprint 13)

По результатам 13 спринта нужно сдать проект, в котором есть:

- успешно протестированы краевые случаи с помощью Charles Proxy
- проведён рефакторинг вьюконтроллера `WebViewViewController`, `ProfileViewController` и `ImageListViewController` покрыты Unit-тестами
- написаны UI-тесты, проверяющие авторизацию в приложение, работу с лентой и работу с профилем.

## Убедитесь, что:

1. Проведён рефакторинг вьюконтроллера `WebViewViewController`.
2. `WebViewController` покрыт Unit-тестами.
3. `ProfileViewController` и `ImageListViewController` покрыты Unit-тестами.
4. Написан UI тест, проверяющий авторизацию в приложение в функции `testAuth()`.
5. Написан UI тест, проверяющий работу с лентой в функции `testFeed()`.
6. Написан UI тест, проверяющий работу с профилем в функции `testProfile()`.
7. Приложение должно поддерживать устройства iPhone с iOS 13 или выше, предусмотрен только портретный режим.

## Техническое задание: 

[Макет в Figma](https://www.figma.com/file/HyDfKh5UVPOhPZIhBqIm3q/Image-Feed-(YP))

## Реализовано в 12 спринте:

1. В проекте реализована постраничная загрузка данных для ленты фотографий.
2. Реализована функциональность лайков.
3. При тапе на картинку в общем списке изображений должен осуществляться переход на экран, где можно посмотреть полноразмерную версию фотографии (также фото можно зумить).
4. Добавлена возможность выхода из аккаунта.
5. Приложение должно поддерживать устройства iPhone с iOS 13 или выше, предусмотрен только портретный режим.

## Реализовано в 11 спринте:

1. Устранено состояние гонки в `OAuthService`.
2. Устранено состояние гонки c помощью блокировки UI.
3. Сделан сетевой слой для экрана профиля.
4. Пока идёт загрузка данных профиля, показывается `Splash Screen`.
5. Для отображения аватарки пользователя использована библиотека `Kingfisher`.
6. В проект добавлен `SwiftKeychainWrapper` через SPM.
7. При получении ошибки в сетевом запросе в `SplashViewController` нужно показать `UIAlertController` с заголовком «Что-то пошло не так(», подписью «Не удалось войти в систему» и кнопкой «Ок» для скрытия алерта.
8. Ключевое окно `(keyWindow)` создаётся из кода.

## Реализовано в 10 спринте:
1. Приложение зарегистрировано на сайте Unsplash.
2. Экран авторизации содержит логотип приложения и кнопку «Войти».
3. Для входа в приложение пользователь авторизуется через OAuth2.0:
- При входе в приложение пользователь видит `splash-screen`;
- После загрузки приложения открывается экран с возможностью авторизации;
- При нажатии на кнопку «Войти» открывается браузер на странице авторизации Unsplash;
- При нажатии на кнопку `Login`, если авторизация в Unsplash прошла успешно, браузер закрывается и выполняется POST-запрос для получения `Auth Token`;
- Если POST-запрос завершается успешно, то экран авторизации скрывается, а в приложении открывается экран с лентой.
4. В проекте создан файл `Constants.swift`, в нём есть константы `accessKey`, `secretKey`, `redirectURI` и `accessScope`:
- В этих константах сохранены `Access key`, `Secret key` и `Redirect URI` вашего приложения;
- `accessScope` — список доступов, разделённых плюсом;
- Также добавлена константа `defaultBaseURL` — в неё сохранён базовый адрес API из документации. Эта константа должна быть типа `URL`.
5. Свёрстан контроллер `WebView`, его дизайн соответствует ТЗ.
6. Реализован `KVO` — приложение показывает, как обновляется прогресс загрузки веб-страницы.
7. Проверка необходимости авторизации выделена в отдельный контроллер `SplashViewController`:
- Создан стартовый контроллер, который выполняет проверку, был ли ранее авторизован пользователь;
- Если есть сохранённые данные об авторизации, пользователя отправляют на флоу галереи, если нет — на флоу авторизации;
- При первом запуске приложения пользователь видит `SplashViewController`, а затем — форму авторизации;
- При повторном запуске после ранее успешной авторизации пользователь сразу после `SplashViewController` попадает в галерею.
8. Добавлена структура для декодинга JSON-ответа от POST-запроса авторизации Unsplash — `OAuthTokenResponseBody`.
9. Создан новый класс `OAuth2Service`:
- В нём объявлена функция `fetchAuthToken`, которая получает code на вход и, используя его, делает POST-запрос.
- Функция `fetchAuthToken` вторым аргументом получает `completion` — блок, который нужно вызвать при получении результатов HTTP-запроса.
- Аргумент `completion` возвращает `Swift.Result<String, Error>`, где success соответствует только ситуации, когда в ответе на запрос был получен положительный HTTP статус-код (значение в дипазоне 200 — 299). При этом блок `completion` вызван на главном потоке (`DispatchQueue.main`)
- В классе `AuthViewController`, там, где объявлен метод делегата `WebViewViewController(_ vc: WebViewViewController, didAuthenticateWithCode code: String)`, вызван `fetchAuthToken`.
- В случае успешного выполнения запроса `Bearer Token` сохранён в `User Defaults` с использованием класса `OAuth2TokenStorage`.

  
## Реализовано в 9 спринте:

1. Экран профиля пользователя свёрстан кодом:
- создан соответствующий класс `ProfileViewController`;
- создан новый `UIViewController` в Storyobard;
- на него добавлены `UIImageView`, `UILabel` и `UIButton` в соответствии с ТЗ;
- констрейнты расставлены нужным образом;
- из Figma выгружены соответствующие ресурсы (картинка для профиля и картинка для кнопки логаута) и подставлены в нужные элементы в `ProfileViewController`.

2. Добавлен экран отдельного изображения `SingleImageViewController`:
- при открытии изображения на весь экран пользователь видит растянутое изображение до границ экрана;
- изображение выровнено по центру;
- добавлен `ScrollView` на экран `SingleImageViewController` и выставили ему констрейнты, равные нулю со всех сторон;
- добавлен `outlet` для `ScrollView` (и назван, соответственно, `scrollView`).

3. На экране `SingleImageViewController` реализована кнопка «Поделиться»:
- размеры и кнопка иконки соответствуют макету;
- кнопка расположена над `ScrollView`, а не внутри него;
- реализован метод `didTapShareButton`, который вызывается при тапе на кнопку;
- добавлена функциональность шеринга картинки.

## Реализовано в 8 спринте:

1. Создан новый проект, в котором:
- iOS 13.0 указана как минимально поддерживаемая версия;
- в настройках основного таргета отключена сборка на iPad;
- проставлена только галочка поддержки портретной ориентации (в секции `Device Orientation`), а в `Info` удалены соответствующие значения для `Supported interface orientations (iPhone)`;
- структура файлов совпадает со структурой, которую мы рассмотрели в теме «Инициализация второго проекта»;
- для проекта подключён Git — в меню `Source Control` в Xcode вам будут доступны меню управления репозиторием.

2. Свёрстан `Launch Screen` приложения:
- экран должен полностью соответствовать макету

3.  Свёрстан главный экран с лентой изображений со следующими параметрами:
- лента содержит 20 фотографий;
- между фото есть отступ;
- края фотографий скруглены;
- на фото добавлен лейбл с текущей датой;
- на фото добавлена кнопка лайка;
- лайк проставлен у ячеек с чётным индексом и не проставлен — у нечётным;
- размеры, параметры и отступы элементов соответствуют макетам;
- высота ячейки зависит от размеров фото и является динамической.
